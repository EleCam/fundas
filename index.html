
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>    
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
</head>

<script>   
$(document).ready(function() {
    //Creacion de elemento funda en canvas 
    function comenzar() {
        var elemento = document.getElementById("funda");
        lienzo = elemento.getContext("2d");
        var imagen = new Image();
        imagen.src = "funda.png";
        imagen.addEventListener("load", manipularimagen, false);
    }

    function manipularimagen(e) {
        imagen = e.target;
        lienzo.drawImage(imagen, 0, 0);
    }
    window.addEventListener("load", comenzar(), false);

    //Movimiento con interact
    const position = {
        x: 0,
        y: 0
    }
   
    //redimencion
    $('#hdt').on('input', function() {
        let wdt = $("#lienzo").width();
        hdt = $(this).val();
        $("#lienzo").css('width', wdt);
        $("#lienzo").css('height', hdt);
    })
    $('#wdt').on('input', function() {
        let hdt = $("#lienzo").height();
        wdt = $(this).val();
        $("#lienzo").css('width', wdt);
        $("#lienzo").css('height', hdt);
    })


    var canvas = document.getElementById("lienzo");
    var ctx = canvas.getContext("2d");
    var degrees = 0;
    var image = document.createElement("img");
    $('input[type=file]').change(function() {
        var file = (this.files[0].name).toString();
        var reader = new FileReader();
        image.onload = function() {
            canvas.width = image.width;
            canvas.height = image.height;
            ctx.drawImage(image, 0, 0);
        }
        reader.onload = function(e) {
            image.src = e.target.result;
        }
        reader.readAsDataURL(this.files[0]);
    });
    //rotacion
    $("#clockwise").click(function() {
        degrees += 90
        if (degrees >= 360) degrees = 0;

        if (degrees === 0 || degrees === 180) {
            canvas.width = image.width;
            canvas.height = image.height;
        } else {
            // swap
            canvas.width = image.height;
            canvas.height = image.width;
        }
        ctx.save();
        // you want to rotate around center of canvas
        ctx.translate(canvas.width / 2, canvas.height / 2);

        ctx.rotate(degrees * Math.PI / 180);

        ctx.drawImage(image, -image.width * 0.5, -image.height * 0.5);
        ctx.restore();
    });

    
    
    
    
    
    
    
    
    
 interact('#lienzo').draggable({
        //              allowFrom: '.guia',
        listeners: {
            start(event) {
                //      console.log(event.type, event.target)
            },
            move(event) {
                position.x += event.dx
                position.y += event.dy

                event.target.style.transform =
                    `translate(${position.x}px, ${position.y}px)`
            },
        }
    }).resizable({
    edges: { top: true, left: true, bottom: true, right: true },
    listeners: {
      move: function (event) {
        let { x, y } = event.target.dataset

        x = (parseFloat(x) || 0) + event.deltaRect.left
        y = (parseFloat(y) || 0) + event.deltaRect.top

        Object.assign(event.target.style, {
          width: `${event.rect.width}px`,
          height: `${event.rect.height}px`,
          transform: `translate(${x}px, ${y}px)`
        })

        Object.assign(event.target.dataset, { x, y })
      }
    }
  }).gesturable({
  listeners: {
    move (event) {
      var arrow = document.getElementById('arrow')

      angle += event.da

      arrow.style.transform = 'rotate(' + angle + 'deg)'

      document.getElementById('angle-info').textContent =
        angle.toFixed(2) + '\u00b0'
    }
  }
})    
    
    
    
    
    
});

</script>
<style>
    .sizebar{
        width: 100%;
        background: black;
    }
    #wdt,#hdt{
        height: 50px;
        width: 100%;
    }
    #clockwise{
        display: block;
        padding: 30px;
    }
    section{
        //position: relative;
        background: red;
        
    }
    canvas.lienzo{
        position: absolute;
        left: 0;
        max-width: 800px;
    }
    #funda{
        pointer-events: none;
        position: absolute;
        z-index: 1000;
/*        display: none;*/
    }
    #lolo{   
        touch-action: none;
        overflow: hidden;
    }
    body{
/*        overflow: hidden;*/
/*        background: black;*/
    }
    #clockwise{
        position: absolute;
        bottom: 0;
        left: 10px;
        z-index: 30000;
    }
    label{
        position: absolute;
        z-index: 4000;
        padding: 20px;
        bottom: 0;
        right: 20px;
        background: white;
    }
</style>
<body>
	<button id="clockwise">Rotar imagen</button>
	<div class="sizebar">
		<input id="wdt"type="range" min="100" max="800" value="400">
		<div class="bnts">
		</div>
	</div>
	<div class="sizebar">
		<input id="hdt"type="range" min="100" max="800" value="400">
		<div class="bnts">
		</div>
	</div>
	<div id="" class="">
		<label for="file">Elegir archivo</label>
	</div>
	<form id="file-submit" enctype="multipart/form-data" style="display: none;">
		<input id="file" name="file" type="file"/>
	</form>
	<section id="lolo">
		<canvas id="funda" width="800px" height="800px" for="lienzo" ></canvas>
		<canvas class="lienzo" id="lienzo" width="800px" height="800px"></canvas>
	</section>
	<!--    <img src="funda.svg" alt="">-->
</body>
</html>
